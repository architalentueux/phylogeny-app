"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");exports.__esModule=true;exports.default=exports.hideFn=exports.extractLabelStyle=exports.checkInvalidValue=void 0;var _inheritsLoose2=_interopRequireDefault(require("@babel/runtime/helpers/inheritsLoose"));var _column=_interopRequireDefault(require("@fusioncharts/charts/src/dataset/column"));var _lib=require("@fusioncharts/core/src/lib");var _dependencyManager=require("@fusioncharts/core/src/dependency-manager");var _task=_interopRequireDefault(require("./task.animation"));var _schedular=require("@fusioncharts/core/src/schedular");var UNDEF;var BLANK="",BOLD="bold",ITALIC="italic",NORMAL="normal",PROCESS="PROCESS_",ROLLOVER="DataPlotRollOver",ROLLOUT="DataPlotRollOut",DATAPLOTDRAGSTART="dataplotdragstart",DATAPLOTDRAGMOVE="dataplotdragmove",EVENTARGS=_lib.preDefStr.EVENTARGS,CANVASLEFTPADDING=1.5,align={left:"start",right:"end",center:"middle"},xAlign={left:0,right:1,center:.5,undefined:.5},alignGutter={left:5,right:-5,center:0,undefined:0},stylePropValues={fontWeight:[NORMAL,BOLD],fontStyle:[NORMAL,ITALIC]},hideFn=function hideFn(){this.hide()},defined=function defined(obj){return obj!==UNDEF&&obj!==null},extractLabelStyle=function extractLabelStyle(styleObj){var style,prop;for(prop in styleObj){if(styleObj[prop]!==UNDEF){style=style||{};switch(prop){case"fontWeight":case"fontStyle":style[prop]=stylePropValues[prop][styleObj[prop]];break;default:style[prop]=styleObj[prop]}}}return style},isPercent=function isPercent(str){return/%/g.test(str)},checkInvalidValue=function checkInvalidValue(){var i=0,ii=arguments.length,allValuesValid=false,val;for(i=0;i<ii;i++){val=arguments[i];if(isNaN(val)){return false}allValuesValid=true}return allValuesValid};exports.checkInvalidValue=checkInvalidValue;exports.extractLabelStyle=extractLabelStyle;exports.hideFn=hideFn;(0,_dependencyManager.addDep)({name:"taskAnimation",type:"animationRule",extension:_task.default});var Task=function(_Column){(0,_inheritsLoose2.default)(Task,_Column);function Task(){var _this;_this=_Column.call(this)||this;_this.components={};return _this}var _proto=Task.prototype;_proto.getName=function getName(){return"task"};_proto.__setDefaultConfig=function __setDefaultConfig(){_Column.prototype.__setDefaultConfig.call(this);var config=this.config;config.showpercentlabel=UNDEF;config.showlabels=UNDEF;config.showborder=1;config.borderthickness=1;config.font=_lib.BLANKSTRING;config.fontcolor=_lib.BLANKSTRING;config.fontsize=_lib.BLANKSTRING;config.color=_lib.BLANKSTRING;config.alpha=_lib.HUNDREDSTRING;config.angle=270;config.slackfillcolor=UNDEF;config.borderalpha=_lib.HUNDREDSTRING;config.hoverfillcolor=_lib.BLANKSTRING;config.slackhoverfillalpha=_lib.HUNDREDSTRING;config.showstartdate=UNDEF;config.showenddate=UNDEF};_proto.configureAttributes=function configureAttributes(){var dataset=this,jsonData=dataset.getFromEnv("dataSource"),userConfig=(0,_lib.extend2)({},jsonData.tasks&&jsonData.tasks.length?jsonData.tasks[0]:jsonData.tasks||{});(0,_lib.parseConfiguration)(userConfig,dataset.config,dataset.getFromEnv("chart").config,{task:true});if(!dataset.components){dataset.components={}}dataset.config.hoverfillalpha=(0,_lib.pluckNumber)(userConfig.hoverfillalpha,dataset.getFromEnv("chart").config.taskhoverfillalpha,_lib.HUNDREDSTRING);dataset._setConfigure();dataset.setState("dirty",true)};_proto._setConfigure=function _setConfigure(newDataset){var dataset=this,datasetConfig=dataset.config,chart=dataset.getFromEnv("chart"),yAxis=chart.getChildren("yAxis")[0],axisConfig=yAxis.config,jsonData=dataset.getFromEnv("dataSource"),chartAttrs=jsonData.chart,JSONData=jsonData.tasks&&jsonData.tasks.length?jsonData.tasks[0]:jsonData.tasks||{},setDataArr=newDataset||JSONData.length?JSONData:JSONData.task,setDataLen=setDataArr&&setDataArr.length,colorM=dataset.getFromEnv("color-manager"),chartConfig=chart.config,numberFormatter=dataset.getFromEnv("number-formatter"),taskMix=chartConfig.taskbarfillmix,taskRatio=chartConfig.taskbarfillratio,showSlackAsFill=chartConfig.showslackasfill,dataStore=dataset.components.data,percentComplete,eDate,sDate,i,processMap=axisConfig.processes.processMap,processes=axisConfig.processes.process.process,processName,arrColor,arrAlpha,arrRatio,dataLabel,dInt=chartConfig.dateintooltip,dataObj,taskObj,alignVal={right:"right",left:"left",undefined:"center",center:"center"},id,tAlpha,tBorderAlpha,tBorderColor,label,color,fillAngle,showPercentLabel,tasksMap=chart.components.tasksMap={},inCanStyle=chartConfig.style.inCanvasStyle,toolText,slHovColor,slColor,tColorObj,tHovColor,tHovBorderColor,taskId,dataConfig,showtooltip=(0,_lib.pluckNumber)(chartAttrs.showtooltip,1),dataLabelStyle=chartConfig.dataLabelStyle,datasetLabelStyle,setLabelStyle;if(!dataStore){dataStore=dataset.components.data=[]}datasetConfig.showlabels=(0,_lib.pluck)(JSONData.showlabels,JSONData.showlabels,JSONData.showname,chartAttrs.showtasklabels,chartAttrs.showtasknames,0);datasetConfig.showTextOutline=(0,_lib.pluckNumber)(chartAttrs.textoutline,0);datasetConfig.allowDrag=(0,_lib.pluckNumber)(chartAttrs.allowdrag,0);datasetLabelStyle=datasetConfig.labelStyle=extractLabelStyle({fontSize:datasetConfig.fontSize,fontFamily:datasetConfig.font});(0,_lib.setLineHeight)(datasetConfig.labelStyle);if(setDataLen){for(i=0;i<setDataLen;i+=1){taskObj=setDataArr[i];id=(0,_lib.pluck)(taskObj.processid);if(id&&typeof id==="string"){id=id.toLowerCase()}taskId=taskObj.id;percentComplete=taskObj.percentcomplete;tAlpha=(0,_lib.pluckNumber)(taskObj.alpha,datasetConfig.alpha);color=(0,_lib.pluck)(taskObj.color,datasetConfig.color,colorM.getColor("plotFillColor"));tBorderAlpha=(0,_lib.pluckNumber)(taskObj.borderalpha,datasetConfig.borderalpha,"100");tBorderColor=(0,_lib.pluck)(taskObj.bordercolor,datasetConfig.bordercolor,colorM.getColor("plotBorderColor"));label=(0,_lib.getFirstValue)((0,_lib.pluck)(taskObj.label,taskObj.name),BLANK);arrColor=colorM.parseColorMix(color,taskMix);arrAlpha=colorM.parseAlphaList(tAlpha.toString(),arrColor.length);arrRatio=colorM.parseRatioList(taskRatio,arrColor.length);fillAngle=(0,_lib.pluckNumber)(taskObj.angle,datasetConfig.angle);dataObj=dataStore[i]||(dataStore[i]={config:{}});dataConfig=dataObj.config;dataConfig.index=i;dataConfig.link=taskObj.link;dataConfig.processId=(0,_lib.pluck)(id,PROCESS+i);dataConfig.textColor=(0,_lib.getFirstColor)((0,_lib.pluck)(taskObj.fontcolor,datasetConfig.fontcolor,inCanStyle.color));dataConfig.textFont=(0,_lib.pluck)(taskObj.font,datasetConfig.font,inCanStyle.fontFamily);dataConfig.textFontSize=(0,_lib.pluckNumber)(taskObj.fontsize,datasetConfig.fontsizes,inCanStyle.fontSize);if(!taskObj.fontsize&&chartConfig.dataLabelStyle){taskObj.fontsize=chartConfig.dataLabelStyle.fontSize}dataConfig.style=extractLabelStyle({fontSize:taskObj.fontsize,fontFamily:taskObj.font});(0,_lib.setLineHeight)(dataConfig.style);setLabelStyle=dataConfig.style;dataConfig.lineHeight=(0,_lib.pluck)(setLabelStyle&&setLabelStyle.lineHeight,datasetLabelStyle&&datasetLabelStyle.lineHeight,dataLabelStyle&&dataLabelStyle.lineHeight);dataConfig.startMs=numberFormatter.getDateValue(taskObj.start).ms;dataConfig.endMs=numberFormatter.getDateValue(taskObj.end).ms;sDate=numberFormatter.getFormattedDate(dataConfig.startMs);eDate=numberFormatter.getFormattedDate(dataConfig.endMs);dataConfig.tAlpha=tAlpha;dataConfig.tBorderColor=tBorderColor;dataConfig.tBorderAlpha=tBorderAlpha;dataLabel=BLANK;dataConfig.percentComplete=percentComplete=Math.min((0,_lib.pluckNumber)(taskObj.percentcomplete,-1),100);dataConfig.labelAlign=alignVal[[(0,_lib.pluck)(taskObj.labelalign,chartConfig.tasklabelsalign).toLowerCase()]];dataConfig.showAsGroup=(0,_lib.pluckNumber)(taskObj.showasgroup,0);showPercentLabel=dataConfig.showPercentLabel=(0,_lib.pluckNumber)(taskObj.showpercentlabel,datasetConfig.showpercentlabel);if((0,_lib.pluckNumber)(taskObj.showlabel,taskObj.showname,datasetConfig.showlabels)){dataLabel=label}if(showPercentLabel&&percentComplete!==-1){dataLabel+=" "+percentComplete+"%"}dataConfig.percentComplete=percentComplete;tColorObj={FCcolor:{color:arrColor.join(),alpha:arrAlpha,ratio:arrRatio,angle:fillAngle}};slColor=colorM.parseColorMix((0,_lib.pluck)(taskObj.slackfillcolor,datasetConfig.slackfillcolor,chartConfig.slackfillcolor),taskMix);slColor=showSlackAsFill?{FCcolor:{color:slColor.join(),alpha:arrAlpha,ratio:arrRatio,angle:fillAngle}}:_lib.TRACKER_FILL;tHovColor={FCcolor:{color:colorM.parseColorMix((0,_lib.pluck)(taskObj.hoverfillcolor,datasetConfig.hoverfillcolor,chartConfig.taskhoverfillcolor,(0,_lib.getDarkColor)(color,80)),taskMix).join(),alpha:colorM.parseAlphaList((0,_lib.pluck)(taskObj.hoverfillalpha,datasetConfig.hoverfillalpha).toString(),arrColor.length),ratio:arrRatio,angle:fillAngle}};tHovBorderColor=(0,_lib.convertColor)((0,_lib.pluck)(taskObj.hoverbordercolor,datasetConfig.hoverbordercolor,(0,_lib.getDarkColor)(tBorderColor,80)),(0,_lib.pluck)(taskObj.hoverborderalpha,datasetConfig.hoverborderalpha,tBorderAlpha));slHovColor=showSlackAsFill?{FCcolor:{color:colorM.parseColorMix((0,_lib.getDarkColor)((0,_lib.pluck)(taskObj.slackhoverfillcolor,datasetConfig.slackhoverfillcolor,chartConfig.slackfillcolor),80),taskMix).join(),alpha:colorM.parseAlphaList((0,_lib.pluck)(taskObj.slackhoverfillalpha,datasetConfig.slackhoverfillalpha,"100").toString(),arrColor.length),ratio:arrRatio,angle:fillAngle}}:_lib.TRACKER_FILL;dataConfig.color=(0,_lib.toRaphaelColor)(tColorObj);dataConfig.rawTaskColor=color;dataConfig.rawTaskAlpha=tAlpha;dataConfig.slackColor=(0,_lib.toRaphaelColor)(slColor);dataConfig.hoverFillColor=(0,_lib.toRaphaelColor)(tHovColor);dataConfig.hoverBorderColor=tHovBorderColor;dataConfig.slackHoverColor=(0,_lib.toRaphaelColor)(slHovColor);dataConfig.showHoverEffect=(0,_lib.pluckNumber)(taskObj.showhovereffect,datasetConfig.showhovereffect,chartAttrs.showhovereffect,1);dataConfig.taskHeight=(0,_lib.pluck)(taskObj.height,"35%");dataConfig.topPadding=(0,_lib.pluck)(taskObj.toppadding,"35%");dataConfig.showPercentLabel=showPercentLabel;dataConfig.endDate=(0,_lib.pluckNumber)(taskObj.showenddate,datasetConfig.showenddate)?eDate:UNDEF;dataConfig._endDate=eDate;dataConfig.startDate=(0,_lib.pluckNumber)(taskObj.showstartdate,datasetConfig.showstartdate)?sDate:UNDEF;dataConfig._startDate=sDate;dataConfig.shadow={opacity:Math.max(tAlpha,tBorderAlpha)/100,inverted:true};dataConfig.id=id;dataConfig.taskId=taskId;dataConfig.borderColor=(0,_lib.convertColor)(tBorderColor,tBorderAlpha);dataConfig.borderThickness=(0,_lib.pluckNumber)(taskObj.showborder,datasetConfig.showborder)?(0,_lib.pluckNumber)(taskObj.borderthickness,datasetConfig.borderthickness):0;toolText=(0,_lib.getValidValue)((0,_lib.parseUnsafeString)((0,_lib.pluck)(taskObj.tooltext,datasetConfig.hovertext,datasetConfig.plottooltext,chartAttrs.plottooltext),false));if(showtooltip){if(toolText!==UNDEF){if(processMap[id]){processName=processMap[id].catObj.label||processMap[id].catObj.name}else{processName=processes[i]&&(processes[i].label||processes[i].name)}toolText=(0,_lib.parseTooltext)(toolText,[3,28,29,30,31],{end:eDate,start:sDate,label:label,percentComplete:percentComplete!==-1?numberFormatter.percentValue(percentComplete):BLANK,processName:processName},datasetConfig)}else{toolText=(label!==BLANK?label+(dInt?", ":BLANK):BLANK)+(dInt?sDate+" - "+eDate:BLANK)}}dataConfig.label=dataLabel;dataConfig.toolText=toolText;typeof taskId==="string"&&(taskId=taskId.toLowerCase());if(taskId!==UNDEF){tasksMap[taskId]=dataStore[i]}}}if((0,_lib.pluckNumber)(JSONData.visible,1)){dataset.setState("visible",true)}else{dataset.setState("visible",false)}};_proto.dragStart=function dragStart(event){var ele=this,data=ele.data("drag-options"),dataset=data.dataset;dataset._dragStart.call(ele,event)};_proto._dragStart=function _dragStart(){var element=this,data=element.data("drag-options"),dataObj=data.dataObj,dataGraphics=dataObj.graphics,ele=dataGraphics.element,bBox=ele.getBBox(),config=dataObj.config,dataset=data.dataset,numberFormatter=dataset.getFromEnv("number-formatter"),chart=dataset.getFromEnv("chart"),sourceEvent=DATAPLOTDRAGSTART,dragStart=config.dragStart||(config.dragStart={}),dragData=config.dragData||(config.dragData={}),eventArgs;dragStart.xPos=config.xPos;dragStart.x=config.xPos;dragStart.bBox=bBox;dragData.prevStartDate=numberFormatter.getFormattedDate(config.startMs);dragData.prevEndDate=numberFormatter.getFormattedDate(config.endMs);dragStart.origX=dragStart.lastDx||(dragStart.lastDx=0);eventArgs=ele.data(EVENTARGS);chart.fireChartInstanceEvent(sourceEvent,eventArgs)};_proto.dragMove=function dragMove(event,customData){var ele=this,data=ele.data("drag-options"),dataset=data.dataset,dx=customData[0],dy=customData[1],px=customData[2],py=customData[3];dataset._dragMove.call(ele,dx,dy,px,py)};_proto._dragMove=function _dragMove(dxVal){var _dataSource$tasks,_dataObj$config;var element=this,dx=dxVal,i,canvasPadding=CANVASLEFTPADDING,data=element.data("drag-options"),dataObj=data.dataObj,dataset=data.dataset,datasetConfig=dataset.config,dataSource=dataset.getFromEnv("dataSource"),chartAttr=dataSource.chart,task=dataSource==null?void 0:(_dataSource$tasks=dataSource.tasks)==null?void 0:_dataSource$tasks.task,chart=dataset.getFromEnv("chart"),numberFormatter=dataset.getFromEnv("number-formatter"),yAxis=dataset.getFromEnv("yAxis"),xAxis=dataset.getFromEnv("xAxis"),processMap=xAxis.config.processes.processMap,dataStore=dataset.components.data,ele=dataObj.graphics.element,config=dataObj.config,id=config.id,index=config==null?void 0:config.index,taskObj=task[index],label=(0,_lib.getFirstValue)((0,_lib.pluck)(taskObj.label,taskObj.name),BLANK),percentComplete=Math.min((0,_lib.pluckNumber)(taskObj.percentcomplete,-1),100),dragStart=config.dragStart,dragData=config.dragData,startX=dragStart.bBox.x+dx,endX=dragStart.bBox.x2+dx,chartConfig=dataset.getFromEnv("chartConfig"),canvasLeft=chartConfig.canvasLeft,toolText="",processName,canvasRight=yAxis.getPixel(chartConfig.scrollOptions.viewPortMax),dInt=chartConfig.dateintooltip,len,viewPortScale,setObj;if(chartConfig.scrolltodate){viewPortScale=chartConfig.viewPortConfig.scaleX*chartConfig.viewPortConfig.x;canvasLeft=canvasLeft+viewPortScale;canvasRight=canvasRight+viewPortScale}if(startX<canvasLeft){dx+=canvasLeft+canvasPadding-startX}if(endX>canvasRight){dx-=endX-canvasRight}if(dx){ele.data("fire_click_event",0)}if(taskObj){toolText=(0,_lib.getValidValue)((0,_lib.parseUnsafeString)((0,_lib.pluck)(taskObj.tooltext,datasetConfig.hovertext,datasetConfig.plottooltext,chartAttr.plottooltext),false));if(toolText!==UNDEF){if(id&&processMap[id]){processName=processMap[id].catObj.label||processMap[id].catObj.name}toolText=(0,_lib.parseTooltext)(toolText,[3,28,29,30,31],{end:numberFormatter.getFormattedDate(dataObj.config.endMs),start:numberFormatter.getFormattedDate(dataObj.config.startMs),label:label,percentComplete:percentComplete!==-1?numberFormatter.percentValue(percentComplete):BLANK,processName:processName},dataset.config)}else{toolText=(label!==BLANK?label+(dInt?", ":BLANK):BLANK)+(dInt?numberFormatter.getFormattedDate(dataObj.config.startMs)+" - "+numberFormatter.getFormattedDate(dataObj.config.endMs):BLANK)}}dragStart.lastDx=dx;dataObj.config.startMs=yAxis.getDraggedValue(dragStart.xPos+dragStart.lastDx);dataObj.config.endMs=yAxis.getDraggedValue(dragStart.xPos+dragStart.lastDx+dataObj.config.width);dataObj.config.toolText=toolText;dragData.updatedStartDate=numberFormatter.getFormattedDate(dataObj.config.startMs);dragData.updatedEndDate=numberFormatter.getFormattedDate(dataObj.config.endMs);dragData.index=dataObj==null?void 0:(_dataObj$config=dataObj.config)==null?void 0:_dataObj$config.index;dragData.id=dataObj==null?void 0:dataObj.config.taskId;for(i=0,len=dataStore.length;i<len;i++){setObj=dataStore[i];if(dataObj.config.index===setObj.config.index){break}}chart.fireChartInstanceEvent(DATAPLOTDRAGMOVE,dragData);dataset.parsePlotAttributes(dataObj,i);dataset&&dataset.draw();dataset.taskHoverHandler.call(element,chart)};_proto.dragUp=function dragUp(event){var ele=this,data=ele.data("drag-options"),dataset=data.dataset;dataset._dragUp.call(ele,event)};_proto._dragUp=function _dragUp(event){var element=this,data=element.data("drag-options"),dataset=data.dataset,chart=dataset.getFromEnv("chart");dataset.taskHoverOutHandler.call(element,chart)};_proto.slackElemHandlers=function slackElemHandlers(slackElem,chart){var dataset=this;if(slackElem){slackElem.on("fc-click",(function(e){var ele=this;chart.plotEventHandler(ele,e)})).hover((function(data){var ele=this,dataObj=ele.data("dataObj");chart.plotEventHandler(ele,data,ROLLOVER);dataObj.config.showHoverEffect&&dataset.taskHoverHandler.call(ele,chart)}),(function(data){var ele=this,dataObj=ele.data("dataObj");chart.plotEventHandler(ele,data,ROLLOUT);dataObj.config.showHoverEffect&&dataset.taskHoverOutHandler.call(ele,chart)}))}};_proto.trimData=function trimData(datasetJSON){if(!this.config.JSONData){return}var dataSet=this,config=dataSet.config,context=config&&config.context,prevCatlen=context&&context.prevCatlen,xAxis=dataSet.getFromEnv("xAxis"),currCatLen=xAxis.getProcessLen(),catDiff=prevCatlen-currCatLen,prevData=config.JSONData,prevDataLength=prevData.task&&prevData.task.length,currDataLength=datasetJSON.task&&datasetJSON.task.length||0,dataDiff=prevDataLength-currDataLength,diff,startIndex;if(catDiff>dataDiff){diff=catDiff;startIndex=currCatLen}else{diff=dataDiff;startIndex=currDataLength}if(diff>0){this.removeData(startIndex,diff,false)}};_proto.getAxisValuePadding=function getAxisValuePadding(){return this.config.defaultPadding};_proto.drawLabel=function drawLabel(){var dataset=this,conf=dataset.config,chart=dataset.getFromEnv("chart"),animationManager=dataset.getFromEnv("animationManager"),dataStore=dataset.components.data,valElemDummy,startValElemDummy,endValElemDummy,valElem,startValElem,endValElem,config,graphics,dataObj,eventArgs,textAttr,startLabelTextAttr,endLabelTextAttr,dataLabelContainer=dataset.getContainer("dataLabelContainer"),i,len=dataStore.length;for(i=0;i<len;i++){dataObj=dataStore[i];config=dataObj.config;graphics=dataObj.graphics;eventArgs=config.eventArgs;valElemDummy=graphics.valElem;textAttr=config._labelTextAttr;if(defined(config.label)&&config.label!==BLANK&&textAttr){valElem=graphics.valElem=animationManager.setAnimation({el:valElemDummy||"text",attr:textAttr,container:dataLabelContainer,component:dataset});valElem.outlineText(conf.showTextOutline,textAttr.fill);if(!valElemDummy){valElem.data("dataset",dataset);dataset.slackElemHandlers(valElem,chart)}else{valElem.removeCSS();valElem.show()}valElem.css(config.style);valElem.data("dataObj",dataObj).data("dataObj",dataObj).data("eventArgs",eventArgs)}else{valElemDummy&&animationManager.setAnimation({el:valElemDummy,component:dataset,callback:hideFn,doNotRemove:true})}startValElemDummy=graphics.startValElem;startLabelTextAttr=config._startLabelTextAttr;if(defined(config.startDate)&&config.startDate!==BLANK&&startLabelTextAttr){startValElem=graphics.startValElem=animationManager.setAnimation({el:startValElemDummy||"text",attr:startLabelTextAttr,container:dataLabelContainer,component:dataset});startValElem.outlineText(conf.showTextOutline,startLabelTextAttr.fill);if(!startValElemDummy){startValElem.data("dataset",dataset);dataset.slackElemHandlers(startValElem,chart)}else{startValElem.removeCSS();startValElem.show()}startValElem.css(config.style);startValElem.data("dataObj",dataObj).data("chart",chart).data("eventArgs",eventArgs)}else{startValElemDummy&&animationManager.setAnimation({el:startValElemDummy,component:dataset,callback:hideFn,doNotRemove:true})}endValElemDummy=graphics.endValElem;endLabelTextAttr=config._endLabelTextAttr;if(defined(config.endDate)&&config.endDate!==BLANK&&endLabelTextAttr){endValElem=graphics.endValElem=animationManager.setAnimation({el:endValElemDummy||"text",attr:endLabelTextAttr,container:dataLabelContainer,component:dataset});endValElem.outlineText(conf.showTextOutline,endLabelTextAttr.fill);if(!endValElemDummy){endValElem.data("dataset",dataset);dataset.slackElemHandlers(endValElem,chart)}else{endValElem.removeCSS();endValElem.show().css(config.style)}endValElem.data("dataObj",dataObj).data("chart",chart).data("eventArgs",eventArgs)}else{endValElemDummy&&animationManager.setAnimation({el:endValElemDummy,component:dataset,callback:hideFn,doNotRemove:true})}}};_proto.taskHoverHandler=function taskHoverHandler(){var ele=this,dataObj=ele.data("dataObj")||{},dataset=ele.data("dataset"),dataStore=dataset.components.data,config=dataObj.config||{},index=config.index,graphics=dataStore[index]&&dataStore[index].graphics,attrib={fill:config.hoverFillColor,stroke:config.hoverBorderColor};if(config.percentComplete!==-1&&!config.showAsGroup){graphics.slackElem.attr({fill:config.slackHoverColor});graphics.taskFill.attr({fill:config.hoverFillColor});delete attrib.fill}graphics.element.attr(attrib)};_proto.taskHoverOutHandler=function taskHoverOutHandler(){var ele=this,dataObj=ele.data("dataObj")||{},dataset=ele.data("dataset")||{},dataStore=dataset.components.data,config=dataObj.config||{},index=config.index,graphics=dataStore[index]&&dataStore[index].graphics,attrib={fill:config.color,stroke:config.borderColor,"stroke-width":config.borderThickness,"stroke-dasharray":config.dashedStyle};if(config.percentComplete!==-1&&!config.showAsGroup){graphics.slackElem.attr({fill:config.slackColor});graphics.taskFill.attr({fill:config.color});delete attrib.fill}graphics.element.attr(attrib)};_proto.parsePlotAttributes=function parsePlotAttributes(dataObj,index){var _dataset$config,_config,_config$style,_config2,_config2$style;var dataset=this,chart=dataset.getFromEnv("chart"),jsonData=chart.getFromEnv("dataSource"),chartConfig=chart.config,canvasTop=chartConfig.canvasTop,xAxis=chart.getChildren("xAxis")[0],yAxis=chart.getChildren("yAxis")[0],config,endX,startMs,endMs,setLink,height,id,pHeight,width,width2,xPos,yPos,borderThickness,taskBarElementAttrs,crispBox,halfH,txtAlign,borderFill,padding,incrementId=index,datePadding=chartConfig.datepadding,taskHeight,viewPortConfig=chartConfig.viewPortConfig,x=viewPortConfig.x,labelTextAttr,endLabelTextAttr,startLabelTextAttr,proLen=jsonData.processes.process&&jsonData.processes.process.length,scaleX=viewPortConfig.scaleX,taskBarRadius=chartConfig.taskbarroundradius,cursor,processDimention,lineHeight;config=dataObj&&dataObj.config;!dataObj.graphics&&(dataObj.graphics={});startMs=config&&config.startMs;endMs=config&&config.endMs;if(typeof dataObj==="undefined"||typeof startMs==="undefined"||endMs===null){return}taskHeight=config.taskHeight;setLink=config.link;borderThickness=config.borderThickness;id=config.id;borderFill=config.color;lineHeight=config.lineHeight;if(incrementId>proLen-1){incrementId=0}if(typeof config.id!=="undefined"){processDimention=yAxis.getProcessPositionById(id)}else{processDimention=yAxis.getProcessPositionByIndex(incrementId)}incrementId++;pHeight=processDimention.height;padding=pHeight*(isPercent(config.topPadding)&&parseFloat(config.topPadding,10)*.01)||(0,_lib.pluckNumber)(config.topPadding,pHeight);height=config.height=pHeight*(isPercent(taskHeight)&&parseFloat(taskHeight,10)*.01)||(0,_lib.pluckNumber)(taskHeight,pHeight);xPos=config.xPos=xAxis.getPixel(config.startMs)+x*scaleX;endX=xAxis.getPixel(config.endMs)+x*scaleX;width=config.width=Math.abs(width2=endX-xPos);yPos=processDimention.bottom+canvasTop-pHeight;yPos=config.yPos=yPos+Math.min(padding,pHeight-height);halfH=height*.5;crispBox=(0,_lib.crispBound)(xPos,yPos,width,height,borderThickness);xPos=crispBox.x;yPos=crispBox.y;width=crispBox.width;height=crispBox.height;if(checkInvalidValue(xPos,yPos,width,height)===false){config.inValidValue=true;return}config.props={element:{},perComElem:{},slackElem:{}};if(config.showAsGroup){taskBarElementAttrs={path:["M",xPos,yPos,"V",yPos+height,"L",xPos+halfH,yPos+halfH,"H",xPos+width-halfH,"L",xPos+width,yPos+height,"V",yPos,"H",xPos]}}else{taskBarElementAttrs={x:crispBox.x,y:crispBox.y,width:crispBox.width||1,height:height}}Object.assign(taskBarElementAttrs,{fill:borderFill,stroke:config.borderColor,cursor:setLink?"pointer":dataset!=null&&(_dataset$config=dataset.config)!=null&&_dataset$config.allowDrag?"move":BLANK,r:taskBarRadius,"stroke-width":borderThickness,width:crispBox.width||1});config.eventArgs={processId:config.processId,taskId:config.taskId,start:config._startDate,end:config._endDate,showAsGroup:config.showAsGroup,link:config.link,sourceType:"task",percentComplete:config.percentComplete!==-1,bgColor:config.rawTaskColor,bgAlpha:config.rawTaskAlpha,font:config.textFont,fontSize:config.textFontSize,fontColor:config.textColor};if(config.percentComplete!==-1&&!config.showAsGroup){width2=width*config.percentComplete*.01;borderFill=_lib.TRACKER_FILL;config.props.perComElem={attr:{x:xPos,y:yPos,height:height,width:width2,fill:config.color,cursor:setLink?"pointer":BLANK,"stroke-width":0}};config.props.slackElem={attr:{x:xPos+width2||1,y:yPos,width:width-width2,height:height,fill:config.slackColor,cursor:setLink?"pointer":BLANK,"stroke-width":0}};taskBarElementAttrs.fill=borderFill}txtAlign=config.labelAlign;labelTextAttr=config._labelTextAttr||(config._labelTextAttr={});config.props.element.attr=taskBarElementAttrs;labelTextAttr.x=xPos+width*xAlign[txtAlign]+alignGutter[txtAlign];labelTextAttr.y=yPos-parseInt(lineHeight,10)*.5-chartConfig.tasklabelspadding;labelTextAttr.text=config.label;labelTextAttr.direction=chartConfig.textDirection;labelTextAttr["text-anchor"]=align[txtAlign];labelTextAttr.cursor=cursor;labelTextAttr.fill=(0,_lib.convertColor)(config.textColor);labelTextAttr["line-height"]=lineHeight;startLabelTextAttr=config._startLabelTextAttr||(config._startLabelTextAttr={});startLabelTextAttr.x=xPos-2-datePadding;startLabelTextAttr.y=yPos+height*.5;startLabelTextAttr.text=config.startDate;startLabelTextAttr["text-anchor"]=_lib.POSITION_END;startLabelTextAttr.cursor=cursor;startLabelTextAttr.direction=chartConfig.textDirection;startLabelTextAttr.fill=(0,_lib.convertColor)(config.textColor);startLabelTextAttr["line-height"]=lineHeight;startLabelTextAttr["font-size"]=(_config=config)==null?void 0:(_config$style=_config.style)==null?void 0:_config$style.fontSize;endLabelTextAttr=config._endLabelTextAttr||(config._endLabelTextAttr={});endLabelTextAttr.x=xPos+width+2+datePadding;endLabelTextAttr.y=yPos+height*.5;endLabelTextAttr.text=config.endDate;endLabelTextAttr.cursor=cursor;endLabelTextAttr.direction=chartConfig.textDirection;endLabelTextAttr["text-anchor"]=_lib.POSITION_START;endLabelTextAttr.fill=(0,_lib.convertColor)(config.textColor);endLabelTextAttr["line-height"]=lineHeight;endLabelTextAttr["font-size"]=(_config2=config)==null?void 0:(_config2$style=_config2.style)==null?void 0:_config2$style.fontSize;config.cursor=cursor};_proto.allocatePosition=function allocatePosition(){var dataset=this,dsStore=dataset.components.data||[],length=dsStore.length,i,dataObj;for(i=0;i<length;i++){dataObj=dsStore[i];dataset.parsePlotAttributes(dataObj,i)}};_proto._removeDataVisuals=function _removeDataVisuals(dataObj){var dataset=this,animationManager=dataset.getFromEnv("animationManager"),ele,graphics,graphicsObj;if(!dataObj){return}graphics=dataObj.graphics;for(ele in graphics){graphicsObj=graphics[ele];graphicsObj&&animationManager.setAnimation({el:graphicsObj,component:dataset})}};_proto.draw=function draw(){var dataset=this,i,visible=dataset.getState("visible"),chart=dataset.getFromEnv("chart"),toolTipController=dataset.getFromEnv("toolTipController"),chartConfig=chart.config,canvas=chart.getChildren("canvas")[0],animationManager=dataset.getFromEnv("animationManager"),len,parentContainer=canvas.getChildContainer("taskGroup"),components=dataset.components,dataStore=components.data,dataObj,config,graphics,removeDataArr=components.removeDataArr,removeDataArrLen=removeDataArr&&removeDataArr.length,dataLabelsLayer=chart.getChildContainer("datalabelsGroup"),labelsGroup=canvas.getContainer("labelsGroup"),dataLabelContainer=dataset.getContainer("dataLabelContainer"),isContextChanged=dataset._contextChanged(),container=dataset.getContainer("taskColumnContainer"),shadowContainer=dataset.getContainer("taskColumnShadowContainer"),startMs,endMs,toolText,taskBarElement,perComElem,perComElemDummy,slackElem,slackElemDummy,elemType,taskBarElementAttrs,eventArgs,shadow=chartConfig.showshadow,dragMove=dataset.dragMove,dragStart=dataset.dragStart,dragUp=dataset.dragUp,conf=dataset.config;if(!dataset.getState("removed")&&!dataset.getState("dirty")&&!(isContextChanged&&visible)&&!conf.allowDrag){return}if(!container){container=dataset.addContainer("taskColumnContainer",animationManager.setAnimation({el:"group",attr:{name:"columns"},container:parentContainer,component:dataset}))}if(!visible){container.hide()}else{container.show()}if(!labelsGroup){labelsGroup=canvas.addContainer("labelsGroup",animationManager.setAnimation({el:"group",attr:{name:"task-plot-labels"},container:dataLabelsLayer,component:canvas}))}if(!dataLabelContainer){dataLabelContainer=dataset.addContainer("dataLabelContainer",animationManager.setAnimation({el:"group",attr:{name:"labels"},container:parentContainer,component:dataset}))}else{dataLabelContainer.removeCSS()}if(!visible){dataLabelContainer.hide()}else{dataLabelContainer.show()}labelsGroup=animationManager.setAnimation({el:labelsGroup,attr:{transform:"T"+-chart.config.xOffset+",0"},component:canvas});dataLabelContainer.css(conf.labelStyle);if(!shadowContainer){shadowContainer=dataset.addContainer("taskColumnShadowContainer",animationManager.setAnimation({el:"group",attr:{name:"shadow"},container:parentContainer,component:dataset}).toBack());if(!visible){shadowContainer.hide()}}len=dataStore.length;for(i=0;i<len;i++){dataObj=dataStore[i];config=dataObj&&dataObj.config;!dataObj.graphics&&(dataObj.graphics={});graphics=dataObj.graphics;startMs=config&&config.startMs;endMs=config&&config.endMs;if(typeof dataObj==="undefined"||typeof startMs==="undefined"||endMs===null){continue}toolText=config.toolText;if(config.inValidValue){continue}taskBarElement=graphics.element;elemType=config.showAsGroup?"path":"rect";if(taskBarElement&&taskBarElement.type!==elemType){taskBarElement.remove();taskBarElement=graphics.element=null}taskBarElementAttrs=config.props.element.attr;graphics.element=animationManager.setAnimation({el:taskBarElement||elemType,label:elemType,attr:taskBarElementAttrs,container:container,component:dataset});if(!taskBarElement){taskBarElement=graphics.element;if(conf!=null&&conf.allowDrag){taskBarElement.drag(dragMove,dragStart,dragUp)}taskBarElement.data("dataset",dataset);dataset.slackElemHandlers(taskBarElement,chart)}eventArgs=config.eventArgs;if(config.percentComplete!==-1&&!config.showAsGroup){perComElemDummy=graphics.taskFill;slackElemDummy=graphics.slackElem;perComElem=graphics.taskFill=animationManager.setAnimation({el:perComElemDummy||"rect",attr:config.props.perComElem.attr,container:container,component:dataset});if(!perComElemDummy){dataset.slackElemHandlers(perComElem,chart)}slackElem=graphics.slackElem=animationManager.setAnimation({el:slackElemDummy||"rect",attr:config.props.slackElem.attr,container:container,component:dataset});if(!slackElemDummy){dataset.slackElemHandlers(slackElem,chart)}perComElem.show();perComElem.data("chart",chart).data("dataObj",dataObj).data("dataset",dataset);toolTipController.enableToolTip(perComElem,toolText);slackElem.show();perComElem&&perComElem.data("eventArgs",eventArgs);slackElem&&slackElem.data("eventArgs",eventArgs).data("dataObj",dataObj).data("dataset",dataset).data("chart",chart)}else{graphics.taskFill&&animationManager.setAnimation({el:graphics.taskFill,component:dataset,callback:hideFn,doNotRemove:true});graphics.slackElem&&animationManager.setAnimation({el:graphics.slackElem,component:dataset,callback:hideFn,doNotRemove:true})}taskBarElement.show().shadow({opacity:shadow},shadowContainer).data("dataObj",dataObj).data("chart",chart).data("dataset",dataset).data("eventArgs",eventArgs);if(conf!=null&&conf.allowDrag){taskBarElement.data("drag-options",{dataObj:dataObj,dataset:dataset,datasetIndex:dataset.index,pointIndex:dataObj.config.index,cursor:"move",chart:chart,link:dataObj.link})}toolTipController.enableToolTip(taskBarElement,toolText)}dataset.drawn?dataset.drawLabel():dataset.addJob("drawLabel",dataset.drawLabel.bind(dataset),_schedular.priorityList.label);dataset.drawn=true;for(i=0;i<removeDataArrLen;i++){dataset._removeDataVisuals(removeDataArr.shift())}};return Task}(_column.default);var _default=Task;exports.default=_default;